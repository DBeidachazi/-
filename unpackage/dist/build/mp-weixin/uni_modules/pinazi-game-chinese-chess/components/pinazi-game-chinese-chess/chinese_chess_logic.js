"use strict";const t=require("./calc_pawn_targets.js"),r=require("./evaluate_panel_weight.js");var e;e=["rc1 rm1 rx1 rs1 rj1 rs2 rx2 rm2 rc2 ","000 000 000 000 000 000 000 000 000","000 rp1 000 000 000 000 000 rp2 000","rz1 000 rz2 000 rz3 000 rz4 000 rz5","000 000 000 000 000 000 000 000 000","000 000 000 000 000 000 000 000 000","mz1 000 mz2 000 mz3 000 mz4 000 mz5","000 mp1 000 000 000 000 000 mp2 000","000 000 000 000 000 000 000 000 000","mc1 mm1 mx1 ms1 mj1 ms2 mx2 mm2 mc2"];var a={c:"创",m:"孝",x:"典",s:"绝",j:"蚌",p:"急",z:"对"},i={c:"盒",m:"批",x:"寄",s:"乐",j:"赢",p:"麻",z:"退"},s={panel:{},status_const:{me:1,rival:2},history_steps:[],is_own_turn:!0,all_matrix:[],all_win_arr:[],total_win_count:0,my_win_arr:[],rival_win_arr:[],is_game_over:!1,own_weight:[],rival_weight:[],renderView:(t,r,e)=>{},mySucceed:t=>{},myFailed:t=>{},init(t,r){return this.is_game_over=!1,this.is_own_turn=!0,this.total_win_count=0,this.all_win_arr=[],Object.assign(this,t),this.initPanelWithPawns(),this},initPanelWithPawns(){var t=[];for(var r in e){var a=e[r],i=[],s=(a=a.trim()).split(/\s+/);for(var n in s)i.push(this.getInitSinglePawnData(s[n],r,n));t.push(i)}return this.all_matrix=t,t},defaultItem:(t,r)=>({x:r,y:t,is_target_blink:!1,is_selected:!1,status:0}),getInitSinglePawnData(t,r,e){var s=this.defaultItem(parseInt(r),parseInt(e));if(3!==t.length)return console.error(t+"格式不对"),!1;if("000"!==t){var n="r"===t[0],l=t[2],o=t[1];s=Object.assign(s,{status:n?this.status_const.rival:this.status_const.me,text:n?i[o]:a[o],code:o,num:l,is_rival:n})}return s},getNewStepMatrix(t,r,e){var a=JSON.parse(JSON.stringify(e));a[t.y][t.x]=this.defaultItem(t.y,t.x);var i=Object.assign({},t,{x:r.x,y:r.y});return a[r.y][r.x]=i,a},onClickEvent(t,r){console.log(t,r)},calcAllTargetPoints:(r,e)=>t.calc_pawn_targets.getPointsArr(r,e),calcPanelVals:t=>r.evaluate_panel_weight.evaluate(t),getAllOneSideSteps(t,r){var e=this.getOneSidePawns(t,r),a=[];for(var i in e){var s=e[i],n=this.calcAllTargetPoints(s,t);for(var l in n)a.push({from:s,to:n[l]})}return a},calcAiStep(t){console.log("calc-");var r=this.getAllOneSideSteps(t,!0),e=1e5,a=null;for(var i in console.log(r),r){var s=r[i],n=this.getNewStepMatrix(s.from,s.to,t),l=this.getAllOneSideSteps(n,!1),o=-1e4;for(var c in l){var _=l[c],m=this.getNewStepMatrix(_.from,_.to,n),u=this.calcPanelVals(m);u>o&&(o=u)}o<e&&(console.log(o),e=o,a=s)}return console.log(a),a},recursiveCalcAiSteps(t,r,e){if(0===e)return{val:this.calcPanelVals(t)}},calcAiStepBf(t){var r=this.getOneSidePawns(t,!0);for(var e in r.sort((()=>Math.random()>=.5?-1:1)),r){var a=r[e],i=this.calcAllTargetPoints(a,t);if(i.length)return i.sort((()=>Math.random()>=.5?-1:1)),{from:a,to:i[0]}}return null},getOneSidePawns(t,r){var e=[];for(var a in t)for(var i in t[a])t[a][i].status&&t[a][i].is_rival===r&&e.push(t[a][i]);return e},getOneSideJiang(t,r){var e=this.getOneSidePawns(t,r);for(var a in e)if("j"===e[a].code)return e[a];return null}};exports.chinese_chess_logic=s;

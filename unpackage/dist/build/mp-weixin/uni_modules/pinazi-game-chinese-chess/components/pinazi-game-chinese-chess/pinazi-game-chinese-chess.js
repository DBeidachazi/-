"use strict";const t=require("../../../../common/vendor.js"),e=require("./chinese_chess_logic.js"),i={name:"pinazi-game-chinese-chess",data:()=>({all_data:[[]],panel:{x:9,y:10},status_const:{me:1,rival:2},ai_first:!0,cell_length:40,pawn_length:34,current_clicked_item:null,current_target_arr:null}),mounted(){this.init()},methods:{init(){this.logic_obj=e.chinese_chess_logic.init({status_const:this.status_const},this.ai_first),this.initAllData()},putPawn(t,e,i){i?this.status_const.rival:this.status_const.me},initAllData(){for(var t in this.all_data=[],this.logic_obj.all_matrix){var e=[];for(var i in this.logic_obj.all_matrix[t])e.push(this.logic_obj.all_matrix[t][i]);this.all_data.push(e)}},panelCenterStyle(){return{lineHeight:this.cell_length+"px",height:this.cell_length+"px",fontSize:.6*this.cell_length+"px"}},customSingleCellStyle(t,e){return{width:this.cell_length+"px",height:this.cell_length+"px"}},customSingleCellClass(t,e){var i="";return(7===e&&3===t||0===e&&3===t)&&(i="shi_bias"),i},pawnClass(t){var e="none";switch(t.status){case 2:e="red";break;case 1:e="black"}return t.is_selected&&(e+=" selected"),t.is_target_blink&&(e+=" target_blink"),e},pawnStyle(t){return{fontSize:.6*this.pawn_length+"px",fontWeight:"bold",width:this.pawn_length+"px",height:this.pawn_length+"px",left:this.cell_length*t.x-this.pawn_length/2+"px",top:this.cell_length*t.y-this.pawn_length/2+"px"}},getLengthIndex(t){var e=0;t>0&&(e=parseInt(t/this.cell_length),t%this.cell_length>this.cell_length/2&&(e+=1));return e},restart(){this.init()},failed(){t.index.showModal({content:"输了",confirmText:"再来一局",success:t=>{(t.confirm||t.cancel)&&this.restart()}})},succeed(){t.index.showModal({content:"赢了",confirmText:"再来一局",success:t=>{(t.confirm||t.cancel)&&this.restart()}})},clickEvent(t){if(!this.logic_obj.is_own_turn)return console.log("不该我们移子"),!1;if(this.logic_obj.is_game_over)return console.log("游戏已经结束"),!1;var e=t.detail.x-t.currentTarget.offsetLeft,i=t.detail.y-t.currentTarget.offsetTop,s=this.getLengthIndex(e),l=this.getLengthIndex(i),a=this.all_data[l][s];if(this.current_clicked_item){if(a.status&&!a.is_rival)this.clearSelectedStatus(),this.itemSelected(a);else if(!!this.current_target_arr.filter((t=>t.x===a.x&&t.y===a.y)).length){if(this.logic_obj.history_steps.push({from:this.current_clicked_item,to:a,is_eating:a.status}),this.clearSelectedStatus(),this.moveStep(this.current_clicked_item,a),!this.logic_obj.getOneSideJiang(this.all_data,!0))return this.logic_obj.is_game_over=!0,this.succeed(),!1;this.current_clicked_item=null,this.current_target_arr=null,this.logic_obj.is_own_turn=!this.logic_obj.is_own_turn;var n=this.logic_obj.calcAiStep(this.all_data);if(this.moveStep(n.from,n.to),this.logic_obj.is_own_turn=!this.logic_obj.is_own_turn,!this.logic_obj.getOneSideJiang(this.all_data,!1))return this.logic_obj.is_game_over=!0,this.failed(),!1}}else{if(!a.status||a.is_rival)return console.log("不该点"),!1;this.itemSelected(a)}},moveStep(t,e){this.$set(this,"all_data",this.logic_obj.getNewStepMatrix(t,e,this.all_data))},clearSelectedStatus(){for(var t in this.$set(this.current_clicked_item,"is_selected",!1),this.current_target_arr)this.$set(this.current_target_arr[t],"is_target_blink",!1)},itemSelected(t){for(var e in this.current_clicked_item=t,this.$set(t,"is_selected",!0),this.current_target_arr=this.logic_obj.calcAllTargetPoints(this.current_clicked_item,this.all_data),this.current_target_arr)this.$set(this.current_target_arr[e],"is_target_blink",!0)}}};const s=t._export_sfc(i,[["render",function(e,i,s,l,a,n){return{a:t.f(9,((e,i,s)=>t.e({a:4===i},4===i?{b:t.s(n.panelCenterStyle())}:{c:t.f(8,((e,s,l)=>({a:s,b:t.n(n.customSingleCellClass(s,i)),c:t.s(n.customSingleCellStyle(s,i))})))},{d:e}))),b:t.f(a.all_data,((e,i,s)=>({a:t.f(e,((e,i,s)=>t.e({a:e.status},e.status?{b:t.t(e.text)}:{},{c:t.n(n.pawnClass(e)),d:t.s(n.pawnStyle(e))})))}))),c:t.o(((...t)=>n.clickEvent&&n.clickEvent(...t)))}}],["__scopeId","data-v-a8aa34fd"]]);wx.createComponent(s);
